---
title: "Women's Soccer Data"
---

We'll use this notebook to explore some NCAA women's soccer data and [our questions](https://docs.google.com/spreadsheets/d/1G1AjH2iS6kj3kKHCRi0XVy5Lcm-rahJkeTAToVh9J1g/edit?gid=0#gid=0). First, let's load the tidyverse library:

```{r}
library(tidyverse)
```

We'll want to start with 2025 match data, which is located in [this GitHub repository](https://github.com/dwillis/NCAAWomensSoccerData). We can load the match data directly from GitHub using `read_csv`:

###First portion of notebook 
```{r}
matches_2025 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv") |> mutate(goal_dif = team_score - opponent_score, total_goals = goals + defensive_goals)

matches_2024 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2024.csv") |> mutate(goal_dif = team_score - opponent_score, total_goals = goals + defensive_goals)
```

Let's take a look at this data to see what it contains, using `head` and `glimpse`:

```{r}
head(matches_2025)
glimpse(matches_2025)
```

Now, onto the questions using aggregates, which means `group_by` and `summarize`:

1.  How many shots in total has Maryland attempted and how many have been on goal? Calculate a percentage of shots on goal.

```{r}
matches_2025 |>
 # filter(team == "Maryland Terrapins, Terps") |>
  group_by(team) |> 
  summarize(
    total_shots = sum(sh_att),
    total_on_goal = sum(so_g),
    pct_on_goal = (((sum(so_g))/(sum(sh_att)))*100)
  ) |>
  arrange(desc(pct_on_goal))


```

2.  What about the same shot stats from last season's first four games? You'll need to load the matches from 2024 - just change the season in the URL - and filter by date to find the first four games.

```{r}
matches_2024 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2024.csv")

matches_2024 |>
  filter(team == "Maryland Terrapins, Terps") |>
  filter(case_when(
    opponent == "Lehigh" ~ TRUE,
    opponent == "Stony Brook" ~ TRUE,
    opponent == "American" ~ TRUE,
    opponent == "James Madison" ~ TRUE,
  )) |>
  summarize(
    total_shots = sum(sh_att),
    total_on_goal = sum(so_g),
    pct_on_goal = (((sum(so_g))/(sum(sh_att)))*100)
  )
  
  


```

3.  Maryland started 2022 with 4 draws. Have any other teams had as many this season?

```{r}
matches_2025 |>
  group_by(team) |>
  filter(outcome == "Draw") |>
  summarize(total_draws = n()) |>
  arrange(desc(total_draws))

##Only Cal Poly and Drexel had four or more draws at all in the 2025 data set. Upon checking both of their results, it appears Cal Poly had all five in a row. Drexel had two in a row at most. So Cal Poly not only matches Maryland's streak, but surpassed it.##


```

4.  How many total corner kicks has Maryland had so far this season and how many have its opponents have? Calculate the difference between the two totals for every team using group_by, summarize and mutate, then filter to find Maryland's totals.

```{r}
matches_2025 |>
  group_by(team) |>
  summarize(total_corners_for = sum(corners), total_corners_against = sum(defensive_corners), difference = ((sum(corners)-sum(defensive_corners)))) |> 
  filter(team == "Maryland Terrapins, Terps")


                                                                                                          
```

5.  What's the most interesting thing you've seen from these questions?

```{r}
swac_teams <- c("Alabama A&M Bulldogs", "Alabama St. Lady Hornets", "Alcorn Lady Braves", "Ark.-Pine Bluff Lady Lions", "Grambling Lady Tigers", "Jackson St. Lady Tigers", "Mississippi Val. Devilettes", "Prairie View Lady Panthers", "Southern U. Lady Jaguars", "Texas Southern Lady Tigers")

swac_matches <- matches_2025 |> 
  filter(team %in% swac_teams)
```

```{r}
matches_2025 |> 
  summarise(
    mean_diff = mean(goal_dif),
    mean_opp_goals = mean(defensive_goals),
    mean_sog = mean(so_g),
    mean_opp_sog = mean(defensive_so_g)
    )
```

```{r}
swac_matches |> 
  summarise(
    mean_diff = mean(goal_dif),
    mean_opp_goals = mean(defensive_goals),
    mean_sog = mean(so_g),
    mean_opp_sog = mean(defensive_so_g)
  )
```

```{r}
big10 <- c("Nebraska Huskers", "Iowa Hawkeyes", "Minnesota Golden Gophers", "Illinois Fighting Illini", "Northwestern Wildcats", "Wisconsin Badgers", "Indiana Hoosiers", "Purdue Boilermakers", "Ohio St. Buckeyes", "Michigan Wolverines", "Michigan St. Spartans", "Penn St. Nittany Lions", "Rutgers Scarlet Knights", "Maryland Terrapins, Terps", "Southern California Trojans", "UCLA Bruins", "Washington Huskies", "Oregon Ducks")

big10_matches <- matches_2025 |> 
  filter(team %in% big10)
```

```{r}
big10_matches |> 
  summarise(
    mean_diff = mean(goal_dif),
    mean_opp_goals = mean(defensive_goals),
    mean_sog = mean(so_g),
    mean_opp_sog = mean(defensive_so_g)
  )
```


I don't think I've ever properly taken advantage of the filter function and I always seem to get myself confused when I am parsing through the data by writing code in the filter function. I had a bit of a moment of clarity with it in this assignment. For whatever reason, just hasn't always processed in my brain well. Something clicked while I did this assignment, whatever it was.

I think I am also finding more and more comfort in R with the many different ways you can achieve the result you want. Compared to myself at this time last year where an assignment like this would freak me out and take me forever to do because I was trying to find the perfect solution, I could think of multiple ways to go about answering some of these questions as I worked through the notebook.

In terms of the actual data analysis aspect of it, there are a lot of good basic stats we can work with here because we are easily able to work with game-by-game numbers as well as grouping them together for bigger picture, season-long stats. That allows us to make more direct comparisons from team to team or from game to game for a certain team. We can discover trends in the data with granular information like this as well as look for improvement or regression in a certain team, stat or performance.

###NEW STUFF FROM SEPT 18

###T TEST FROM CLASS
```{r}
t.test(matches_2024$total_goals, matches_2025$total_goals)
```
While the result of this test does show us that there is a statistically significant difference between 2024 and 2025's average total for scoring because the p value is less than 0.05, that doesn't tell the whole story here. We can reject the null hypothesis that there is not a significant difference in scoring between the two seasons, but because the 2025 season has far fewer games played and has yet to reach conference play, the increase in scoring in 2025 may not simply mean that teams are actually scoring more. This is a case where the statistical tests on their own don't provide all the context a human can add. We must know to balance both. As discussed in class, when the 2024 data was filtered for the same stretch of the season as thus far in 2025, the p value was very large and showed it was much more likely any difference in scoring this year is more likely due to random chance. 

###What about for Maryland? 
```{r}
maryland_2024 <- matches_2024 |> filter(team == "Maryland Terrapins, Terps")
maryland_2025 <- matches_2025 |> filter(team == "Maryland Terrapins, Terps")
```

```{r}
t.test(maryland_2024$total_goals, maryland_2025$total_goals)
```
With Maryland's specific data, however, we do see an increase in scoring and with a large p value above 0.05. That means we must accept the null hypothesis which states there is not a significant difference in scoring. There is a small sample size this year compared to last year as with the data mentioned in the nationwide set, but our t test shows Maryland's increase in scoring is not actually a significant difference. Per the stats, it may be more due to random chance. With our context as reporters, we can say Maryland may have inflated scoring numbers because it hasn't gotten into a stretch of playing better teams yet. As I am writing this sitting at the checkout booth in Knight Hall, Maryland is playing the mighty Indiana Hoosiers just across the street here on campus and has yet to score a goal as of 8:42 p.m. on Thursday. And Indiana certainly is not a good team either. So how bad were the teams Maryland was actually able to to score against? 

**UPDATE: So it's 9:06 now and maryland somehow won that game? lol, everyone sucks**


## Correlations & Regression

```{r}
correlations <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2024.csv")
```

```{r}
newcorrelations <- correlations |> 
  mutate(
    differential = goals - defensive_goals
    )
```

```{r}
newcorrelations |> summarise(correlation = cor(differential, fouls, method="pearson"))

newcorrelations |> summarise(correlation = cor(differential, yellow_cards, method="pearson"))
```

```{r}
fit <- lm(differential ~ fouls, data = newcorrelations)
summary(fit)

fit
```

```{r}
newcorrelations |> 
  summarise(correlation = cor(differential, so_g, method="pearson"))
```
```{r}
net <- lm(differential ~ so_g, data = newcorrelations)
summary(net)
```
### 2025 version 

```{r}
correlations_2025 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv")

newcorrelations_2025 <- correlations_2025 |> 
  mutate(
    differential = goals - defensive_goals
    )
```

```{r}
newcorrelations_2025 |> summarise(correlation = cor(differential, defensive_sh_att, method="pearson"))
```

```{r}
defensive_model <- lm(differential ~ defensive_sh_att, data = newcorrelations_2025)
summary(defensive_model)
```

### How does Maryland rank in terms of shots allowed 
```{r}
newcorrelations_2025 |> group_by(team) |> 
  summarize(avg_shots_allowed = mean(defensive_sh_att)) |> 
  arrange(avg_shots_allowed) |> 
  filter(team == "Maryland Terrapins, Terps")

#lets test the model for Maryland's 2-1 win over purdue 
intercept_co <- 2.647310
defensive_sh_co <- -0.209785

(defensive_sh_co*20) + intercept_co
```

Game data from the 2025 season shows that the number of shots a team allows does not appear to have any noticeable impact on its goal differential. Maryland's performance against Purdue demonstrates that. On average, Maryland allows 12.8 shot attempts per game. That's 207th nationally. That's definitely not good. It's also not the worst! Against Purdue, Maryland's defense allowed 20 shot attempts. On the surface, that would seem to lead toward the belief that Maryland wasn't good defensively, or certainly worse than usual. And maybe it wasn't. Our model predicts Maryland should have lost by about 1.55 goals given the number of shots it allowed. But Maryland won the game 2-1. That's more than a two goal swing from what the model would have predicted. So we can determine shot attempts allowed don't really matter. The strongest impact appears to be more from a team's offensive output, especially in terms of shots on goal. Based on these two stats, it seems more valuable to be more productive on offense than defense. Maryland has lost games where its allowed fewer shot attempts than it did against Purdue. Maryland allowed 15 shot attempts against James Madison, and lost 1-0. So it may be okay for Maryland's opponents to pepper the net. Just so long as Maryland has enough offense to produce on its own end. That much has been a struggle. 